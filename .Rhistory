#scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35)) +
coord_equal()
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
anamolies
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(mdist = ifelse(!player %in% anamolies, 0, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
ggplot(., aes(V1, V2)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
#scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35)) +
coord_equal()
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist))
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
rename(mahalanobis_distance = mdist) %>%
mutate(mdist = ifelse(!player %in% anamolies, 0, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
ggplot(., aes(V1, V2)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35)) +
coord_equal()
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
rename(mdist = mahalanobis_distance) %>%
mutate(mdist = ifelse(!player %in% anamolies, 0, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
ggplot(., aes(V1, V2)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35)) +
coord_equal()
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
rename(mahalanobis_distance = mdist) %>%
mutate(mdist = ifelse(!player %in% anamolies, 0, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
ggplot(., aes(V1, V2)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35)) +
coord_equal()
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist))
rename
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
rename(a = mdist)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
rename(mahalanobis_distance = mdist)
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(mdist = ifelse(!player %in% anamolies, 0, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35)) +
coord_equal()
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
data_analysis %>%
top_n(5, wt=mdist)
data_analysis %>%
top_n(5, wt=mdist)
data_analysis %>%
top_n(10, wt=mdist)
data_analysis %>% mutate(mdist = mh) %>%
top_n(10, wt=mdist)
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
#mutate(mdist = ifelse(!player %in% anamolies, 0, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35)) +
coord_equal()
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
#mutate(mdist = ifelse(!player %in% anamolies, 0, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35))
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, value, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=player, fill=value)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5))
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, value, -player, -team, -mdist)
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, value, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, value), fill=value)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5))
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, value, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, -value), fill=value)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5))
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, value, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, stat, -value), fill=value)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5))
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, value, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, -value), fill=value)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5))
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, value, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, value), fill=value)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5))
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, value, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, value), fill=value)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5))
pc <- prcomp(data_analysis[-c(1:2)], center=FALSE, scale.=FALSE)
pc
pc$x
pc <- prcomp(data_analysis[-c(1:2)], center=FALSE, scale.=FALSE)
pc$x %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
#mutate(mdist = ifelse(!player %in% anamolies, 0, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(PC1, PC2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35))
pc <- prcomp(data_analysis[-c(1:2)], center=FALSE, scale.=FALSE)
pc$x %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(PC1, PC2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
data_analysis %>%
top_n(5, wt=mdist)
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9) +
xlim(c(-35, 35)) +
ylim(c(-35, 35))
pc <- prcomp(data_analysis[-c(1:2)], center=FALSE, scale.=FALSE)
pc$x %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(PC1, PC2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
pc <- prcomp(data_analysis[-c(1:2)], center=FALSE, scale.=FALSE)
pc$x %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(PC1, PC2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
anomolies
anamolies <- data_analysis %>%
top_n(5, wt=mdist)
anamolies <- data_analysis %>%
top_n(5, wt=mdist)  %>%
pull(player)
data_analysis %>%
top_n(5, wt=mdist)
data_analysis %>%
top_n(10, wt=mdist)
data_analysis %>%
top_n(10, wt=mdist) %>%
rename(anomaly_score = mdist)
data_analysis %>%
top_n(10, wt=mdist) %>%
rename(anomaly_score = mdist) %>%
select(1:3)
data_analysis %>%
top_n(10, wt=mdist) %>%
rename(anomaly_score = mdist) %>%
select(1:3) %>%
write.table("clipboard", sep = "\t")
data_analysis %>%
top_n(10, wt=mdist) %>%
rename(anomaly_score = mdist) %>%
select(1:3) %>%
write.table(., "clipboard", sep = "\t")
data_analysis %>%
top_n(10, wt=mdist) %>%
rename(anomaly_score = mdist) %>%
select(1:3) %>%
write.table(., "clipboard", sep = "\t", row.names=FALSE)
?write.table
data_analysis %>%
top_n(10, wt=mdist) %>%
rename(anomaly_score = mdist) %>%
select(1:3) %>%
write.table(., "clipboard", sep = "\t", row.names=FALSE)
pipe
data_analysis %>%
top_n(10, wt=mdist) %>%
rename(anomaly_score = mdist) %>%
select(1:3) %>%
write.table(., pipe("pbcopy", "w"), sep = "\t", row.names=FALSE)
data_analysis %>%
top_n(10, wt=mdist) %>%
rename(anomaly_score = mdist) %>%
select(1:3) %>%
write.table(., pipe("pbcopy"), sep = "\t", row.names=FALSE)
library(DMwR)
# local outlier factor
lof <- lofactor(data_analysis[-c(1:2)], k=5)
lof
?lofactor
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = lof)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
lof <- lofactor(data_analysis[-c(1:2)], k=25)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = lof)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
# local outlier factor
lof <- lofactor(data_analysis[-c(1:2)], k=10)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = lof)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, z_score, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, value), fill=z_score)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5)) +
ylab("Player") +
xlab("Statistic")
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, z_score, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, z_score), fill=z_score)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5)) +
ylab("Player") +
xlab("Statistic")
data_analysis %>%
top_n(5, wt=mdist)
data
data %>% filter(player %in% anamolies$player)
anamolies
anamolies <- data_analysis %>%
top_n(10, wt=mdist)  %>%
pull(player)
anomalies <- data_analysis %>%
top_n(10, wt=mdist)  %>%
pull(player)
tsne$Y %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(V1, V2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
pc <- prcomp(data_analysis[-c(1:2)], center=FALSE, scale.=FALSE)
pc$x %>%
as_tibble() %>%
bind_cols(data_analysis %>% select(player, mdist)) %>%
mutate(player = ifelse(player %in% c("LeBron James", "Chinanu Onuaku"), player, NA)) %>%
rename(mahalanobis_distance = mdist) %>%
ggplot(., aes(PC1, PC2, color = mahalanobis_distance)) +
geom_point(alpha=.9) +
geom_label_repel(aes(label=player), box.padding=.35, point.padding=.5) +
theme_minimal() +
scale_color_viridis_c(begin = .1, end = .9)
data %>% filter(player %in% anomalies)
knitr::spin("R/scrapesville.R")
knitr::spin("R/scrapesville.R")
knitr::render("R/scrapesville.R")
rmarkdown::render("R/scrapesville.R")
data
anomalies
data %>% mutate(mh = mh)
data %>% filter(player %in% anomalies)
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, z_score, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, z_score), fill=z_score)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5)) +
ylab("Player") +
xlab("Statistic")
data_analysis %>%
top_n(50, wt=mdist) %>%
gather(stat, z_score, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, z_score), fill=z_score)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5)) +
ylab("Player") +
xlab("Statistic")
data_analysis
map_if(data_analysis, is.numeric, qplot)
map_if(data_analysis, is.numeric, ~ qplot(.x))
source('~/Documents/code/nba_anomaly/R/data_scraper.R', echo=TRUE)
data <- readr::read_rds("data/nba_2017_stats.Rds")
data
names(data)
analysis_vars <- c("fg_made", "fg_attempts", "three_p_made", "three_p_attemps",
"ft_attempts", "ft_made", "reb_offensive", "reb_defensive",
"assists", "turnovers", "steals", "blocks", "personal_fouls",
"minutes"
)
data_z <- data %>%
select(analysis_vars) %>%
mutate_all(funs( (. - mean(.))/sd(.)))
analysis_vars <- c("fg_made", "fg_attempts", "three_p_made", "three_p_attempts",
"ft_attempts", "ft_made", "reb_offensive", "reb_defensive",
"assists", "turnovers", "steals", "blocks", "personal_fouls",
"minutes"
)
data_z <- data %>%
select(analysis_vars) %>%
mutate_all(funs( (. - mean(.))/sd(.)))
mh <- mahalanobis(
data[analysis_vars],
center=colMeans(data[analysis_vars]),
cov=cov(data[analysis_vars])
)
data_analysis <- data_z %>%
mutate(mdist = mh, player=data$player, team=data$team) %>%
select(player, team, mdist, everything()) %>%
arrange(desc(mdist))
data_analysis %>%
top_n(10, wt=mdist) %>%
gather(stat, z_score, -player, -team, -mdist) %>%
ggplot(., aes(x=stat, y=reorder(player, z_score), fill=z_score)) +
geom_tile() +
scale_fill_viridis_c() +
theme(axis.text.x = element_text(angle = 45, vjust=0.5)) +
ylab("Player") +
xlab("Statistic")
analysis_vars
data_z
data_z %>% summary()
map(data_z, ~ qplot(.x))
data
data %>% filter(player %in% anomalies) %>% filter(gp == 1)
data %>% filter(player %in% anomalies) %>% filter(games_played == 1)
